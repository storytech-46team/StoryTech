# StoryTech
проект команды #46 StoryTech 

# Оглавление
1. [Описание продукта](#Описание-продукта)
    - [Глоссарий с основными терминами и сокращениями](#Глоссарий-с-основными-терминами-и-сокращениями)
    - [Пример структуры навелы](#Пример-структуры-навелы)
    - [Пользователи и сценарии использования](#Пользователи-и-сценарии-использования)
    - [Ключевые метрики успеха MVP проекта StoryTech](#Ключевые-метрики-успеха-MVP-проекта-StoryTech)
2. [Структура входных данных](#Структура-входных-данных)
    - [2.1 Персонажи](#21персонажи)
    - [2.2 Новелла](#22новелла)
    - [2.3 Учебный материал](#23учебный-материал)
    - [2.4 Миры](#24миры)
4. [Требования](#Требования)
    - [Аппаратные](#Аппаратные требования)
    - [Программные](#Программные требования)
5. [Коды, запросы, промпты](#Коды, запросы, промпты)
    - [Структура базы данных](#)

***

## Описание продукта
Проект команды 46 StoryTech представляет из себя исследовательскую миссию по использованию нейронок для генерации новелл к учебным курсам.

**Назначение:** Продукт представляет собой систему для автоматической генерации образовательных новелл с элементами storytelling, которая позволяет создавать курсы с текстами, иллюстрациями, мини-играми и практическими заданиями. Этот инструмент будет использоваться для увеличения вовлеченности студентов через мотивацию, достижения и интерактивные элементы.

**Идеальный образ:** Система будет работать по принципу "новеллы", где каждый урок/модуль превращается в увлекательную историю, наполненную яркими визуальными материалами и заданиями, которые подталкивают студентов к активному участию. Основной фокус на интерактивности и геймификации.

**Справочно:**
В рамках проекта разрабатывается человеко-машинная система, включающая в себя новеллиста и набор технических средств. При этом набор технических средств будет позволять выполнять шаги: 

• выбор темы урока (новеллы) из предметного курса; 

• получение контента урока (новеллы) в виде текста.

• выбор сюжета из ЛОРа и персонажей для формирование промпта сюжета; 

• создание пути героя - основных этапов истории; 

• детализация сюжета (этапов), тайминг сюжетных сцен; 

• генерация картинок по типу комиксов для каждой сцены (без анимации).


Формат представления – рассказ с иллюстрациями, в котором персонаж общими вещами будет объяснять какие-нибудь элементы, предметы обучения. Т.е. представление – слайды с текстом и картинками, в промежутках – мини-игры, практические задания. Материал будет включать элементы состязательности (например, баллы, уровни по результатам выполнения заданий/миссий), а также просто мотивационные элементы (достижения). Предусматривается возможность взаимодействия студентов с персонажами или сюжетом (например, выбор, который изменяет ход истории, вопрос-ответ, игровые задания из разряда «найти что-то»).

***
### Глоссарий с основными терминами и сокращениями

**ЛОР** – это общее описание вселенной или мира, в котором разворачиваются события.

**Storytelling** — техника (способ) подачи материала, путём повествования, создания уникальной атмосферы, визуального стиля и персонажей использование структуры историй для вовлечения аудитории, что применимо для обучения.

**LLM (Large Language Model)** — большие языковые модели, такие как GPT, которые используются для генерации текстового контента.

**Геймификация** — использование игровых механик в неигровых элементах, направленных на повышение вовлеченности в процесс обучения включение элементов игры в образовательный процесс для повышения вовлеченности.

**API** — интерфейсы программирования приложений, которые обеспечивают взаимодействие между сервисами.

**MVP (Minimum Viable Product)** — минимально жизнеспособный продукт, содержащий ключевые функции для начала использования (тестирования).

**JSON** — формат данных, который используется для передачи данных (интеграции) между приложениями и другими сервисами.

**Новеллист (пользователь)** – лицо, переводящее текст лекции в формат истории, создающий новеллу, тот, кто создает обучающий курс в формате новеллы. Для него наша команда и создает инструмент. Новеллист не равно преподаватель. Новеллист берёт готовый технический материал и перекладывает его в историю, новеллу, при том он может вообще не понимать, что такое юпитер ноутбуки, докеры и так далее. Новеллист, в идеале, должен владеть промт-инженерингом хотя бы на базовом уровне, так как значительно проще редактировать, если можешь просто поправить промт. Работа с кодом в рамках продукта от новеллиста не требуется. Настройки предпочтительно только высокоуровневые, то есть, чтобы в какие-то серьёзные настройки закапываться не приходилось

**Арка героя **— сценарное понятие, которое применимо к историям любого формата. Этот термин обозначает путь, который персонаж проходит от первых до последних страниц книги. Если изобразить сюжет истории графически — получится как раз та самая арка с тремя ключевыми точками: начало пути, кульминация и финал.

**Vision** — описание общего представления о конечном продукте в терминах бизнес-отрасли заказчика, отражающее основные задачи, решение которых реализуется посредством проекта

**Модель данных** — логическое определение объектов, которыми оперирует приложение, и связей между ними

**Screen flow** — диаграмма переходов между экранами

**"Сферический конь в вакууме"** - нечто идеальное, но существующее лишь в теории. Совершенно невозможное для применения на практике. Однако, в теории — "живет и работает" прекрасно.

**Новелла** – большая презентация с видео, играми, теорией в виде диалогов, блокнотов, LMS, по которой студент (школьник) проходит обучение в масштабах одного урока.

**Новелла (MVP)** - это интерактивная история, представленная в формате страниц, где каждая страница содержит изображение и текстовые элементы (реплики или описания). Пользователь может листать страницы, постепенно раскрывая сюжет. Каждая страница отражает определенный момент действия, основанный на мизансцене и изменениях, происходящих в рамках диалога или описания.

 **Страница** - единица представления новеллы, состоящая из изображения и текстовых элементов (реплик или описаний). Каждая страница отображает часть одной сцены.

**Листание** -  процесс перехода от одной страницы к другой, читатель видит последовательность изображений и текстов, рассказывающих историю.

**Сюжет новеллы **-  основная идея и последовательность событий, на которой строится новелла, генерируется по занятию (выбранным материалам)

**Структура новеллы** - организационная схема, определяющая порядок и взаимосвязь элементов новеллы.

**Глава** - крупная часть новеллы, объединяющая несколько сцен, посвященных определенной теме или линии повествования. 

**Сцена**  - часть главы, описывающая конкретное место действия и события, происходящие в одно время.

        Содержит:

        Мизансцену (описание окружения и положения персонажей).

        Диалоги между персонажами.

        Изменения в действии или положении персонажей.

        Может содержать несколько страниц.

**Мизансцена**  - подробное описание места действия, поз персонажей, их взаимодействия с окружением и эмоционального состояния.

Используется для создания визуального образа страницы (генерации изображений)

**Изображение** - визуальное представление мизансцены на странице. Создается на основе описания мизансцены и изменений. Является ключевым элементом страницы.

**Диалог** - разговор между персонажами, разделен на реплики. Может быть разделен на части, каждая из которых соответствует определенному изменению в мизансцене.

**Реплика** - слова, произнесенные одним персонажем в рамках диалога

***
### Пример структуры навелы

Новелла - "Киберия: Путь к ИТ-мастерству"

Сюжет -  Джесси и Джей - молодые студенты, интересующиеся информационными технологиями. Во время работы над учебным проектом они случайно обнаруживают старый экспериментальный девайс, который телепортирует их в загадочный мир Киберию. В Киберии все процессы управляются разумными роботами и искусственным интеллектом. Чтобы вернуться домой, друзьям нужно пройти обучение в Академии Киберийских Технологий. На протяжении своего пути они: Изучают основы ИТ от местных "преподавателей-роботов",  Познают популярные IT-профессии через взаимодействие с различными системами, Узнают о востребованности IT-специалистов, наблюдая за работой киберийской экономики, Проходят тренировки и получают знания для безопасного возвращения


``Структура -  содержит главы, такие как "Кто такой ИТ-специалист?", "Какие самые популярные ИТ-профессии"  и т.д.``

    **Глава  1** : "Кто такой ИТ-специалист?" Состоит из сцен: 

        **Сцена 1**. Прибытие в Киберию.
        **Сцена 2**. Введение в профессию.

            **Сцена 2** : "Введение в профессию"
                **Мизансцена**: Аудитория с интерактивными столами и большим экраном. Джесси у экрана, Р-3000 показывает примеры.

                **Диалог**:
                    **Реплика 1** - Р-3000: "ИТ-специалисты пишут код..."
                    **Реплика 2 **- Джесси: "Звучит сложно..."

                Страница 1  к сцене 2  главы 1:
                    Изображение (сгенерировано по мизансцене): Джесси у экрана, Р-3000 показывает примеры.
                    Реплика 1 -  Р-3000: "ИТ-специалисты пишут код..."

                Страница 2  к сцене 2 главы 1:
                    Изображение (сгенерировано по мизансцене): Джесси у экрана, Р-3000 показывает примеры.
                    Реплика 2 -  Джесси: "Звучит сложно..."


***
### Пользователи и сценарии использования

**Пользователи:**
- Школьники/Студенты 14…17 лет — основная аудитория, которые будут взаимодействовать с историей, проходя через различные миссии и выполняя задания.
- Новеллисты — будут создавать и настраивать контент, используя редактор и инструменты ИИ.

**Cценарии использования**
- Студент выбирает тему урока, получает текст и изображения.
- После этого ему предлагаются выборы или задания, влияющие на дальнейший ход сюжета.
- По ходу истории он может зарабатывать баллы, достижения, переходить на новые уровни, взаимодействовать с персонажами.

Алгоритм работы новеллиста
![44eQ6hVP-JzWnX135c](https://github.com/user-attachments/assets/634fffb5-2dd3-4e3b-8aaa-863f3f228d2f)


***
### Технический паплайн
[Технический пайплайн](https://github.com/user-attachments/files/19584210/default.pdf)


***


***
### Ключевые метрики успеха MVP проекта StoryTech

Метрики построены в предположении, что пользователем MVP StoryTech является создатель обучающего курса (новеллист). По этой причине акцент сделан на критерии удобства, эффективности и удовлетворенности самого создателя контента.

    Метрика 1. Удобство создания курса

        1.1 Время на создание отдельных элементов новеллы:

            - Минимальный уровень: отрезки времени, затраченные на создание элементов – сценария, структуры, текста, иллюстраций – должны быть соизмеримы между собой. 
        
                Справочно: Детальная разбивка по этапам покажет, где самые большие затраты времени и ресурсов.
                Это поможет определить, какие именно функции StoryTech должны быть автоматизированы или упрощены в первую очередь.

                Способ контроля критерия – логирование времени в системе или опрос новеллистов.

        1.2 Простота интерфейса:

            - Минимальный уровень: Новеллист может создать курс самостоятельно.

                Справочно: в нашем случае – заказчик может создать курс без помощи команды разработчиков, т.е. нас, стажеров.

                Способ контроля критерия – опрос новеллистов.

        1.3 Время загрузки контента:

            - Минимальный уровень: Загрузка занимают не более 5 минут

        1.4 Время настройки промта:

            - Минимальный уровень: Настройка промта занимает не более 30 минут

        1.5 Время генерации сюжета:

            - Минимальный уровень: Генерация занимает не более 15 минут.

        1.6 Время генерации структуры новеллы:

            - Минимальный уровень: Генерация занимает не более 15 минут

        1.7 Время генерации диалогов:

            - Минимальный уровень: Генерация занимает не более 10 минут на сцену

        1.8 Время генерации изображений:

            - Минимальный уровень: Генерация занимает не более 2 минут на изображение

    Метрика 2. Качество результата

        2.1 Профессиональный вид новеллы:

            - Минимальный уровень: Курс выглядит аккуратно и читабельно.

                Справочно: у персонажей на рисунках по две ноги, одна голова и т.п., сохраняется преемственность изложения от одного эпизода к последующему.

                Способ контроля критерия – опрос новеллистов.

        2.2 Функциональность новеллы:

            - Минимальный уровень: Все элементы курса работают без ошибок.

                Справочно: выполняются все функциональные требования.

                Способ контроля критерия – опрос новеллистов.

    Метрика 3. Поддержка и обучение

        3.1 Наличие обучающих материалов:

            - Минимальный уровень: Есть базовая инструкция и FAQ.

            Способ контроля критерия – опрос новеллистов.

    Метрика 4. Техническая эффективность

        4.1 Скорость загрузки и производительность:

            - Минимальный уровень: Время загрузки страниц в сформированной для ученика новелле не превышает 0,5 сек.

            Справочно: Медленная работа может отпугивать учеников, указывая на необходимость оптимизации.

        4.2 Частота ошибок:

            - Минимальный уровень: Количество ошибок генерации сценария, структуры, текста, иллюстраций должно быть минимальным. 

            Справочно: Высокая частота ошибок указывает на необходимость улучшения стабильности платформы.

    Метрика 5. Обратная связь от учеников

        5.1 Удовлетворенность учеников:

            - Минимальный уровень: 50% учеников оставляют положительные отзывы.
            Способ контроля критерия – опрос учеников.

На настоящем этапе не рассматриваются метрики экономической эффективности и монетизации, охвата новых пользователей, интеграции с другими приложениями и сервисами как выходящие за рамки MVP и не поддающиеся измерению на этапе стажировки.
***

## Структура входных данных

В данном разделе приведен пример таблиц, а так же неободиые sql запросы для их создания.

***
### 2.1 Персонажи

1. Таблица `character_ident` (Идентификация)
   
| **Параметр**          | **Имя**           | **Тип**               |
|-------------------|---------------|-------------------|
| Идентификатор персонажа | id         | PRIMARY KEY       |
| Имя/псевдоним персонажа | name       | VARCHAR(100)      |
| Пол персонажа     | gender       | VARCHAR(1) / VARCHAR(10) |
| Возраст           | age          | INT               |
| Рост              | height       | FLOAT             |
| Вес/комплексия    | weight       | FLOAT             |
| Волосы            | hair         | VARCHAR(100)      |
| Цвет глаз         | eyes_color   | VARCHAR(100)      |
| Одежда            | clothes      | TEXT              |
| Отличительные черты | features    | TEXT              |
| Архетип           | type         | VARCHAR(100)      |



2. Таблица `def_text` (Исходный текст описания)
   
| **Параметр**          | **Имя**                 | **Тип**                          |
|-------------------|---------------------|------------------------------|
| Привязка к персонажу | character_id      | INTEGER REFERENCES character_ident(id) |
| Текст описания    | character_def_text | TEXT                         |




3. Таблица `personality` (Персонализация)
   
| **Параметр**          | **Имя**           | **Тип**                          |
|-------------------|---------------|------------------------------|
| Идентификатор     | id            | PRIMARY KEY                  |
| Привязка к персонажу | character_id | INTEGER REFERENCES character_ident(id) |
| Цель              | aim           | TEXT                         |
| Основные черты    | main_features | TEXT                         |
| Конфликты         | conflicts     | TEXT                         |
| Ценности          | valuations    | TEXT                         |



4. Таблица `skills` (навыки и увлечения)
   
| **Параметр**          | **Имя**           | **Тип**                          |
|-------------------|---------------|------------------------------|
| Идентификатор навыка | id            | PRIMARY KEY                  |
| Привязка к персонажу | character_id | INTEGER REFERENCES character_ident(id) |
| Профессиональные навыки | prof_skills | TEXT                         |
| Хобби             | hobby         | TEXT                         |
| Уникальные способности | unique_skills | TEXT                         |



5. Таблица `adds` (Дополнительно)
   
| **Параметр**          | **Имя**           | **Тип**                          |
|-------------------|---------------|------------------------------|
| Идентификатор     | id            | PRIMARY KEY                  |
| Привязка к персонажу | character_id | INTEGER REFERENCES character_ident(id) |
| Отношения с другими (союзник, наставник, конкурент, изгой) | relation | TEXT                         |
| Репутация         | reputation    | TEXT                         |
| Командная роль (лидер, стратег, исполнитель, аналитик) | team_role | TEXT                         |
| Ключевые эмоции (гнев, тревога, эйфория) | emotions | TEXT                         |
| Триггеры          | triggers      | TEXT                         |
| Трансформация     | transformation | TEXT                         |
| Связь с темой обучения | link | TEXT                         |
| Методы вовлечения (дискуссии, ролевые игры, проекты) | methods | TEXT                         |
| Моральные дилеммы  | dilemma       | TEXT                         |
| Бэкграунд          | background    | TEXT                         |
| Символические элементы (предметы, цвета, фразы) | symbols | TEXT                         |
| Связь с миром (знания локаций, культурные отсылки) | world_connection | TEXT                         |
| Точка роста (какие навыки/знания приобретает) | grows | TEXT                         |
| Ошибки и провалы (как они связаны с учебными целями?) | mistakes | TEXT                         |
| Уроки (какие выводы делает персонаж?) | lessons | TEXT                         |

[SQL скрипт для создания таблиц персонажи](https://github.com/storytech-46team/StoryTech/blob/main/SQL_queries/characters.sql)

Схема таблиц "Персонажи"
![1KuuCAVP-WBADk137N](https://github.com/user-attachments/assets/9a7f0f23-dc99-4633-90e4-65c556b0ed03)

***
### 2.2 Новелла 

1.Таблица `novels` – новеллы

| **Параметр**          | **Имя**           | **Тип**             |
|-------------------|---------------|-----------------|
| Идентификатор     | novel_id      | PRIMARY KEY     |
| Название новеллы  | title         | VARCHAR(255)    |
| Краткий сюжет     | plot_summary  | TEXT            |


2.Таблица `chapters` – главы

| **Параметр**          | **Имя**           | **Тип**             |
|-------------------|---------------|-----------------|
| Идентификатор     | chapter_id    | PRIMARY KEY     |
| Название главы    | title         | VARCHAR(255)    |
| Текст описания главы | chapter_summary | TEXT            |
| Внешний ключ на таблицу `novels` | novel_id        | INTEGER       |
| Порядковый номер главы | chapter_number | INTEGER       |

3.Таблица `scenes` – сцены

| **Параметр**          | **Имя**           | **Тип**             |
|-------------------|---------------|-----------------|
| Идентификатор     | scene_id      | PRIMARY KEY     |
| Название сцены    | title         | VARCHAR(255)    |
| Текст описания сцены | scene_summary | TEXT            |
| Внешний ключ на таблицу `chapters` | chapter_id      | INTEGER       |
| Порядковый номер сцены | scene_number | INTEGER       |

4.Таблица `pages` – страницы

| **Параметр**          | **Имя**           | **Тип**             |
|-------------------|---------------|-----------------|
| Идентификатор     | page_id       | PRIMARY KEY     |
| Путь к изображению | image_path    | VARCHAR(255)    |
| Внешний ключ на таблицу `scenes` | scene_id        | INTEGER       |
| Порядковый номер страницы | page_number | INTEGER       |


5.Таблица `replicas` – реплики

| **Параметр**          | **Имя**           | **Тип**             |
|-------------------|---------------|-----------------|
| Идентификатор     | replica_id    | PRIMARY KEY     |
| Текст реплики     | text          | TEXT            |
| Внешний ключ на таблицу `pages` | page_id         | INTEGER       |
| Внешний ключ на таблицу `characters` | character_id   | INTEGER       |
| Порядковый номер реплики на странице | replica_number | INTEGER       |


[SQL скрипт для создания таблиц новелла](https://github.com/storytech-46team/StoryTech/blob/main/SQL_queries/novel.sql)

Схема таблиц Новелла

![8zTX6WVP-GKx8M137S](https://github.com/user-attachments/assets/92c2c1ec-05d6-478e-ac4c-54b40cf6928d)

***

### 2.3 Учебный материал

1. Таблица `education_courses` (Курсы)

| **Параметр**          | **Имя**           | **Тип**             |
|-------------------|---------------|-----------------|
| Идентификатор курса | id            | PRIMARY KEY     |
| Название курса    | course_name   | VARCHAR(100)    |

2. Таблица `education_modules` (Модули)

| **Параметр**          | **Имя**           | **Тип**                          |
|-------------------|---------------|------------------------------|
| Идентификатор модуля | id            | PRIMARY KEY                  |
| Привязка к курсу   | course_id     | INTEGER REFERENCES courses(id) |
| Название модуля    | module_name   | VARCHAR(100)                 |


3. Таблица `education_lessons_and_materials` (Занятия)

| **Параметр**          | **Имя**           | **Тип**             |
|-------------------|---------------|-----------------|
| Идентификатор занятия | id            | PRIMARY KEY     |
| Привязка к модулю   | module_id     | INTEGER REFERENCES modules(id) |
| Название занятия    | lesson_name   | VARCHAR(100)    |
| Название учебного материала | title         | VARCHAR(100)    |
| Путь к файлу        | file_path     | TEXT            |
| План лекции        | lecture_plan  | TEXT            |
| Ключевые моменты лекции | key_points   | TEXT            |


[SQL скрипт для создания таблиц учебный материал](https://github.com/storytech-46team/StoryTech/blob/main/SQL_queries/educational_material.sql)

![9PIPmSVP-Ahmj9137T](https://github.com/user-attachments/assets/84654a3a-11fa-43f4-92a5-e15d5bbefd0c)


[SQL-скрипт для заполнения учебным материалом блиц:](https://github.com/storytech-46team/StoryTech/blob/main/SQL_queries/insert_educational_material.sql)

***

### 2.4 Миры

1. Таблица `worlds` – Описание миров

| **Параметр**                      | **Имя**               | **Тип**                |
|-------------------------------|-------------------|--------------------|
| Уникальный идентификатор мира | id                | SERIAL PRIMARY KEY |
| Название мира                 | name              | VARCHAR(50)        |
| Исходное текстовое описание мира | world_def_text   | TEXT               |
| Описание мирового ландшафта    | landscape        | TEXT               |
| Устройство населенных пунктов  | settlements_structure | TEXT             |
| Устройство жилых помещений    | housing_structure | TEXT               |
   

2. Таблица `species` – Описание видов персонажей

| **Параметр**                      | **Имя**               | **Тип**                          |
|-------------------------------|-------------------|------------------------------|
| Уникальный идентификатор вида персонажа | id                | PRIMARY KEY                  |
| Ссылка на мир                 | world_id          | INTEGER REFERENCES worlds(id) |
| Название вида персонажа       | species_name      | VARCHAR(50)                   |
| Поведение персонажей данного вида | behavior         | TEXT                         |
| Язык и способы коммуникации   | language_communicatio | TEXT                       |
| Внешний вид персонажей        | appearance        | TEXT                         |
| Образ жизни                   | lifestyle         | TEXT                         |
| Социальная структура          | social_structure  | TEXT                         |
| Ценности и принципы           | values_principles | TEXT                         |
| Уровень технологического развития | tech_level      | TEXT                         |
| Навыки персонажей             | skills            | TEXT                         |

3. Таблица `geographical_objects` – Географические объекты

| **Параметр**                      | **Имя**               | **Тип**                          |
|-------------------------------|-------------------|------------------------------|
| Уникальный идентификатор объекта | id                | PRIMARY KEY                  |
| Ссылка на мир                 | world_id          | INTEGER REFERENCES worlds(id) |
| Название объекта              | object_name       | VARCHAR(50)                   |
| Описание объекта              | object_description | TEXT                         |
| Его предназначение            | object_purpose    | TEXT                         |
| Взаимодействие персонажей с объектом | interaction_with_object | TEXT                       |
| Влияние объекта на мир        | object_impact     | TEXT                         |


[SQL-скрипт для создания таблиц миры](https://github.com/storytech-46team/StoryTech/blob/main/SQL_queries/worlds.sql)

Схема таблиц для “Миры”
![87vaMpVP-38BYQ137K](https://github.com/user-attachments/assets/207fe69c-24ca-446c-b30d-ca2d248ab780)



***

## Требования
В этом разделе описаны требования к проекту, которые необходимы для его воспроизведения
## Аппаратные требования
Технические характеристики сервера:
проц: 
видюха:
ОЗУ:
накопитель:
## Программные требования

## ComfyUI - Генерация изображений через API


### Необходимые модели для работы Flux через ComfyUI:

| **Тип модели**               | **Файл**                     |
|------------------------------|------------------------------|
| **Unet Diffusion Model**     | `flux1-dev.safetensors`      |
| **DualCLIPLoader (clip1)**   | `t5xxl_fp16.safetensors`     |
| **DualCLIPLoader (clip2)**   | `clip_l.safetensors`         |
| **VAE (Variational Autoencoder)** | `ae.safetensors`        |

Дополнительные файлы:
- [Шаблон python запроса изображения](flux/template-flux-api-in-python.py)
- [Визуальное отображение взаимосвязи модулей flux](flux/flux.dev1.node-pipeline.png)



пример - питон версия 
пример - Jupyter Notebook

---

## Коды, запросы, промпты
Код запроса Картинок
Код запроса промптов
Код суммаризации
Код чего то с базой данных
